<!DOCTYPE html>
<html>
	<head>
		<title>Movie</title>

		<meta charset="utf-8">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
		<script type="text/javascript" src="movieApp.js"></script>
		<!-- Bootstrap's js-->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="style.css">

	</head>

	<body>
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand" href="#"><i class="fas fa-film"></i> MovieGuru </a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
			<div class="navbar-nav">
				<a class="nav-item nav-link" href="#">Let's Do This</a>
				<a class="nav-item nav-link" href="#">About</a> <!--Needs an About Page-->
				<a class="nav-item nav-link" href="#">Contact</a> <!--Needs a Contact Page-->
			</div>
			
		</nav>

		<!-- Main Body -->
		<div id="maincontent">
			<div id="paragraph">
			<h1 class="display-4">Welcome to MovieGuru</h1>
			<p class="lead">We help you decide on a movie to watch.</p>
			<p class="lead">
			<div class="container">
			<div class="row">
				<div class="col-md-4 col-sm-4 pink"> 
				</div>
				<div class="input-group col-md-4 col-sm-4 pink">
					<!-- Search bar -->
					<input class="form-control py-2 border-right-0 border" type="search" placeholder="Search a movie" id="search-input">
            		<span class="input-group-append">
                		<button class="icon btn btn-outline-secondary border-left-0 border" type="button", onclick="GenerateMovieTable()">
                    		<i class="fas fa-search-plus"></i>
               			 </button>
              		</span>
				</div>
				<div class="col-md-4 col-sm-4 pink">
				</div>
			</div>
			<p id="break"></p>
			<div class="row">
				<div id="div1" class="col-sm-5th blue">Movie 1 Selected</div>
				<div id="div2" class="col-sm-5th blue">Movie 2 Selected</div>
				<div id="div3" class="col-sm-5th blue">Movie 3 Selected</div>
				<div id="div4" class="col-sm-5th blue">Movie 4 Selected</div>
				<div id="div5" class="col-sm-5th blue">Movie 5 Selected</div>
			</div>
			</div>
			</p>
			</div>
		</div>


		<!-- Main Form -->
		<p id="mainform"></p>
		<div>
				<div id="dvTable">
			<script type="text/javascript">

			function get_movie_dictionary(query){
				dictionary = {};

				searchMovie(dictionary, query).then(function() {
					getDetails(dictionary);
				}).then(function () {
					getCredits(dictionary);
				}).then(function () {
					getRelease(dictionary);
				}).then(function () {
					getKeywords(dictionary);
				});

				return dictionary;
			}

			function searchMovie(dictionary, query){
				var deferred = $.Deferred();
				var settings = {
					"async": true,
					"crossDomain": true,
					"url": "https://api.themoviedb.org/3/search/movie?include_adult=false&page=1&query="+query+"&language=en-US&api_key=07a7c9c75d334aae16ed5f47c759aa7e",
					"method": "GET",
					"headers": {},
					"data": "{}"
				};

				$.ajax(settings).done(function (response) {

					dictionary["id"]=response.results[0].id;
					dictionary["title"] = response.results[0].title;
					dictionary["poster_url"] = "http://image.tmdb.org/t/p/w500/" + response.results[0].poster_path;
					dictionary["language"] = response.results[0].original_language;
					dictionary["rating"] = response.results[0].vote_average;
					dictionary["release_date"] = response.results[0].release_date;
					dictionary["summary"] = response.results[0].overview;
					//return deferred.resolve();
				});
				return deferred.resolve();
			}

			function getKeywords(dictionary){
				var deferred = $.Deferred();
				var settings = {
					"async": true,
					"crossDomain": true,
					"url": "https://api.themoviedb.org/3/movie/"+dictionary["id"]+"/keywords?api_key=07a7c9c75d334aae16ed5f47c759aa7e",
					"method": "GET",
					"headers": {},
					"data": "{}"
				}

				$.ajax(settings).done(function (response) {

					dictionary["tag"] = [];
					for (i = 0; i < response.keywords.length; i++) {
						dictionary["tag"].push(response.keywords[i].name);
					}
				});
				return deferred.resolve();
			}

			function getRelease(dictionary) {
				var deferred = $.Deferred();
				var settings = {
					"async": true,
					"crossDomain": true,
					"url": "https://api.themoviedb.org/3/movie/"+dictionary["id"]+"/release_dates?api_key=07a7c9c75d334aae16ed5f47c759aa7e",
					"method": "GET",
					"headers": {},
					"data": "{}"
				}

				$.ajax(settings).done(function (response) {
					for (i = 0; i < response.results.length; i++) {
						if (response.results[i].iso_3166_1 === "US") {
							dictionary["mpaa_rating"] = response.results[i].release_dates[0].certification;
						}

					}
				});
				return deferred.resolve();
			}

			function getDetails(dictionary){
				var deferred = $.Deferred();
				var settings = {

					"async": true,
					"crossDomain": true,
					"url": "https://api.themoviedb.org/3/movie/"+dictionary['id']+"?language=en-US&api_key=07a7c9c75d334aae16ed5f47c759aa7e",
					"method": "GET",
					"headers": {},
					"data": "{}"
				};

				var i;

				$.ajax(settings).done(function (response) {

					dictionary["genre"] = [];
					for (i = 0; i < response.genres.length; i++) {
						dictionary["genre"].push(response.genres[i].name);
					}
					dictionary['budget'] = response.budget;
					dictionary['imdb_id'] = response.imdb_id;

					dictionary["production_companies"] = [];
					for (i = 0; i < response.production_companies.length; i++) {
						dictionary["production_companies"].push(response.production_companies[i].name);
					}

					dictionary['homepage'] = response.homepage;
					dictionary['box_office'] = response.revenue;
					dictionary['runtime'] = response.runtime;
					return deferred.resolve();
				});

			}

			function getCredits(dictionary){
				var deferred = $.Deferred();
				var settings = {
					"async": true,
					"crossDomain": true,
					"url": "https://api.themoviedb.org/3/movie/"+dictionary['id']+"/credits?api_key=07a7c9c75d334aae16ed5f47c759aa7e",
					"method": "GET",
					"headers": {},
					"data": "{}"
				};
				var i, max;

				$.ajax(settings).done(function (response) {
					if (response.cast.length < 5){
						max = response.cast.length
					} else {
						max = 5
					}

					dictionary['actor'] = [];
					for (i=0; i < max; i++){
						dictionary['actor'].push(response.cast[i].name);
					}

					for(i=0; i < response.crew.length; i++) {
						if (response.crew[i].job === "Director") {
							dictionary['director'] = response.crew[i].name;
						}
					}
					return deferred.resolve();
				});

			}

				function addMovies() {



					var movies = new Array();

					var movie = {};
					

					

					movies.push(get_movie_dictionary("interstellar"));
					movies.push(get_movie_dictionary("annihilation"));
					movies.push(get_movie_dictionary("hereditary"));
					movies.push(get_movie_dictionary("vice"));
					movies.push(get_movie_dictionary("zootopia"));

					setTimeout(function(){

						console.log(movies);

						return movies;
					}, 10000);

				}


				function GenerateMovieTable() {


					var movies = new Array();					

					movies.push(get_movie_dictionary("interstellar"));
					movies.push(get_movie_dictionary("annihilation"));
					movies.push(get_movie_dictionary("hereditary"));
					movies.push(get_movie_dictionary("vice"));
					movies.push(get_movie_dictionary("zootopia"));

					setTimeout(function(){

						console.log(movies);

						//Create a HTML Table element.
						var table = document.createElement("TABLE");
						table.className = "table table-striped";
					
						var numFields = 5;
					
						//Add the header row.
						var row = table.insertRow(-1);

						var headerCell = document.createElement("TH");
						headerCell.innerHTML = ""
						headerCell.padding="0";
						row.appendChild(headerCell)

						var posterWidth = window.innerWidth / (movies.length + 1);

						for (var i = 0; i < movies.length; i++) {
							var headerCell = document.createElement("TH");
							headerCell.innerHTML = "";
							headerCell.padding="0";

							var img = document.createElement('img');
							img.src = movies[i]["poster_url"];
							img.padding="0";
							img.width= posterWidth;
							img.height=posterWidth*1.5;
							
							headerCell.appendChild(img);

							row.appendChild(headerCell);
						}

						//Add the data rows.
						row = table.insertRow(-1);
						var cell = row.insertCell(-1);
						cell.innerHTML = "Title";

						for (var i = 0; i < movies.length; i++) {
							var cell = row.insertCell(-1);
							cell.innerHTML = movies[i]["title"];
						}

						row = table.insertRow(-1);
						var cell = row.insertCell(-1);
						cell.innerHTML = "User Rating";

						for (var i = 0; i < movies.length; i++) {
							var cell = row.insertCell(-1);
							cell.innerHTML = movies[i]["rating"];
						}

						var dvTable = document.getElementById("dvTable");
						dvTable.innerHTML = "";
						dvTable.appendChild(table);

					}, 1000);

				}
				</script>
			</div>
		</div>

		
	</body>
</html>
